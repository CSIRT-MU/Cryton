---
# This example shows how to create and use named sessions.
# It is required to have the `command` and `metasploit` modules installed.

plan:
  name: Sessions example
  owner: Cryton
  stages:
    - name: stage-one
      trigger_type: delta
      trigger_args:
        seconds: 0
      steps:
        - name: create-ssh-session
          is_init: true
          step_type: worker/execute
          arguments:
            create_named_session: session_to_target_1
            module: metasploit
            module_arguments:
              module_type: auxiliary
              module: scanner/ssh/ssh_login
              module_options:
                RHOSTS: {{ session.target }}
                USERNAME: {{ session.username }}
                PASSWORD: {{ session.password }}
          next:
            - type: result
              value: ok
              step: execute-in-session
        - name: execute-in-session
          step_type: worker/execute
          arguments:
            use_named_session: session_to_target_1
            module: command
            module_arguments:
              command: whoami
